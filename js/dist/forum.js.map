{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@katosdev/signature/webpack/bootstrap","webpack://@katosdev/signature/webpack/runtime/compat get default export","webpack://@katosdev/signature/webpack/runtime/define property getters","webpack://@katosdev/signature/webpack/runtime/hasOwnProperty shorthand","webpack://@katosdev/signature/webpack/runtime/make namespace object","webpack://@katosdev/signature/external root \"flarum.core.compat['forum/app']\"","webpack://@katosdev/signature/external root \"flarum.core.compat['common/extend']\"","webpack://@katosdev/signature/external root \"flarum.core.compat['forum/components/UserPage']\"","webpack://@katosdev/signature/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@katosdev/signature/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@katosdev/signature/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@katosdev/signature/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@katosdev/signature/external root \"flarum.core.compat['common/Component']\"","webpack://@katosdev/signature/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@katosdev/signature/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@katosdev/signature/./src/forum/states/SignatureState.tsx","webpack://@katosdev/signature/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@katosdev/signature/./src/forum/components/Signature.tsx","webpack://@katosdev/signature/external root \"flarum.core.compat['common/extenders']\"","webpack://@katosdev/signature/./src/forum/components/SignaturePage.tsx","webpack://@katosdev/signature/external root \"flarum.core.compat['common/models/User']\"","webpack://@katosdev/signature/./src/forum/extend.ts","webpack://@katosdev/signature/./src/forum/index.ts","webpack://@katosdev/signature/./src/forum/extendUserPage.tsx","webpack://@katosdev/signature/./src/forum/extendCommentPost.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/CommentPost'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import Stream from 'flarum/common/utils/Stream';\n\nclass SignatureState {\n  // The content of the signature\n  content: Stream<string>;\n\n  // Indicates whether the signature is being edited\n  editing: boolean;\n\n  constructor() {\n    this.content = Stream('');\n    this.editing = false;\n  }\n\n  // Sets the content of the signature\n  setContent(content: Stream<string>) {\n    this.content = content;\n  }\n\n  // Toggles the editing state\n  toggleEditing() {\n    this.editing = !this.editing;\n  }\n}\n\nexport default SignatureState;\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import Component, { ComponentAttrs } from 'flarum/common/Component';\nimport User from 'flarum/common/models/User';\nimport app from 'flarum/forum/app';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport Button from 'flarum/common/components/Button';\nimport Stream from 'flarum/common/utils/Stream';\nimport SignatureState from '../states/SignatureState';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport type Mithril from 'mithril';\n\ninterface SignatureAttrs extends ComponentAttrs {\n  user: User;\n  readonly?: boolean;\n}\n\nexport default class Signature extends Component<SignatureAttrs> {\n  signatureState!: SignatureState;\n  user!: User;\n  loading: boolean = false;\n\n  oninit(vnode: Mithril.Vnode<SignatureAttrs, this>) {\n    super.oninit(vnode);\n    this.user = vnode.attrs.user;\n    this.signatureState = new SignatureState();\n    this.signatureState.setContent(Stream(this.user.signature() || ''));\n  }\n\n  view() {\n    return (\n      <div className={`Signature ${this.signatureState.editing ? 'editing' : ''}`}>\n        {this.loading ? <LoadingIndicator /> : this.signatureState.editing ? this.renderEditor() : this.renderSignature()}\n      </div>\n    );\n  }\n\n  renderEditor() {\n    return (\n      <div class=\"SignatureEditor\">\n        <TextEditor\n          value={this.signatureState.content()}\n          onchange={this.signatureState.content}\n          placeholder=\"Edit your signature here\"\n          composer={this.signatureState}\n          submitLabel={app.translator.trans('signature.forum.buttons.save')}\n          onsubmit={this.onEditorSubmit.bind(this)}\n        />\n      </div>\n    );\n  }\n\n  onEditorSubmit() {\n    this.save();\n  }\n\n  renderSignature() {\n    return (\n      <div className=\"Signature-content\" onclick={this.edit.bind(this)}>\n        {!this.user.signature() ? <p>{app.translator.trans('signature.forum.profile.click')}</p> : m.trust(this.user.signatureHtml())}\n      </div>\n    );\n  }\n\n  edit() {\n    if (this.user.canEditSignature()) {\n      this.signatureState.toggleEditing();\n      m.redraw();\n    }\n  }\n\n  save() {\n    const signature = this.signatureState.content();\n    this.loading = true;\n\n    this.user\n      .save({ signature })\n      .then(() => {\n        this.loading = false;\n        this.signatureState.setContent(Stream(signature));\n        this.signatureState.toggleEditing();\n        m.redraw();\n      })\n      .catch((error) => {\n        this.loading = false;\n        // Provide specific feedback to the user\n        console.error(error);\n        alert('Error saving signature'); // Replace with a more user-friendly error handling\n        m.redraw();\n      });\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","import UserPage from 'flarum/forum/components/UserPage';\nimport type Mithril from 'mithril';\nimport Signature from './Signature';\n\nexport default class SignaturePage extends UserPage {\n  oninit(vnode: Mithril.Vnode) {\n    super.oninit(vnode);\n\n    this.loadUser(m.route.param('username'));\n  }\n\n  content() {\n    return (\n      <div className=\"SignaturePage\">\n        <Signature user={this.user} />\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","import Extend from 'flarum/common/extenders';\nimport SignaturePage from './components/SignaturePage';\nimport User from 'flarum/common/models/User';\n\nexport default [\n  new Extend.Routes() //\n    .add('user.signature', '/u/:username/signature', SignaturePage),\n\n  new Extend.Model(User) //\n    .attribute<string>('signature')\n    .attribute<string>('signatureHtml')\n    .attribute<boolean>('canEditSignature'),\n];\n","import app from 'flarum/forum/app';\nimport extendUserPage from './extendUserPage';\nimport extendCommentPost from './extendCommentPost';\n\nexport { default as extend } from './extend';\n\napp.initializers.add('katosdev-signature', () => {\n  extendUserPage();\n  extendCommentPost();\n});\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport type Mithril from 'mithril';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ItemList from 'flarum/common/utils/ItemList';\n\nexport default function extendUserPage() {\n  extend(UserPage.prototype, 'navItems', function (items: ItemList<Mithril.Children>) {\n    if (app.session.user) {\n      if (this.user?.id() === app.session.user.id() || app.session.user.canEditSignature()) {\n        items.add(\n          'signature',\n          <LinkButton\n            href={app.route('user.signature', { username: this.user?.username() })}\n            icon=\"fas fa-signature\"\n            class=\"Button Button--link hasIcon\"\n          >\n            {app.translator.trans('signature.forum.buttons.signature')}\n          </LinkButton>,\n          20\n        );\n      }\n    }\n  });\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport type Mithril from 'mithril';\nimport CommentPost from 'flarum/forum/components/CommentPost';\nimport Signature from './components/Signature';\n\nexport default function extendCommentPost() {\n  extend(CommentPost.prototype, 'view', function (vnode: Mithril.Vnode) {\n    if (this.attrs.post.user()) {\n      if (this.attrs.post.user().signature()) {\n        vnode.children.push(<Signature user={this.attrs.post.user()} readonly={true} />);\n      }\n    }\n  });\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","SignatureState","content","editing","this","Stream","_proto","setContent","toggleEditing","Signature","_Component","_this","_len","arguments","length","args","Array","_key","apply","concat","signatureState","user","loading","oninit","vnode","attrs","signature","view","m","className","LoadingIndicator","renderEditor","renderSignature","class","TextEditor","onchange","placeholder","composer","submitLabel","app","trans","onsubmit","onEditorSubmit","save","onclick","edit","trust","signatureHtml","canEditSignature","redraw","_this2","then","error","console","alert","Component","SignaturePage","_UserPage","loadUser","route","param","UserPage","Extend","add","User","attribute","extend","items","_this$user","_this$user2","id","LinkButton","href","username","icon","CommentPost","post","children","push","readonly"],"sourceRoot":""}